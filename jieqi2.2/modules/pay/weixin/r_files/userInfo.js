define(["kernel","libs/rsa","Utils/http","mobile/Controller/userCtrl","validate"],function(a,e,n,t,o){var e=new RSAKey,i=a.rsaKey;e.setPublic(i,"10001");var c=a.Class.extend({info:{timestamp:(new Date).valueOf(),InterValObj:"",count:60,curCount:""},login:function(){var n=this,o=$("#form-login"),i=$("#template-login").html();document.referrer;t.getHeaderInfo().then(function(t){if(null!=t.userVO)return o.html("<div><h4>账号已经登录，即将跳转到个人中心。。。</h4></div>"),void setTimeout(function(){1==a.group?location.href=a.accountsDomain+a.isWeixin+"/people":location.href=a.accountsDomain+"/people"},1e3);o.html(i),a.Weixin&&$(".other-account p a:first").show(),$(".login").click(function(){window.location.href=$(this).data("url")});var c=$("#form"),r=o.find(".btn"),s=c.find("input[name='email']"),l=c.find("input[name='password']"),u=$("input[name='backUrl']").val(),p=c.find("input[name='keep']");c.find("input[name='keep']").click(function(){var a=$(this),e=a.attr("checked");e?a.removeAttr("checked"):a.attr("checked","checked")}),n.validate=c.validate({rules:{email:{required:!0},password:{required:!0}},messages:{email:{required:"请填写手机/邮箱"},password:{required:"请填写密码"}}}),c.submit(function(){return!1}),r.click(function(){""!=s.val()&&""!=l.val()&&n.postJsonp(a.ajaxDomain+"/jsonp/accounts/login",{email1:e.encrypt(s.val().replace(/\s+/g,"")),password1:e.encrypt(l.val().replace(/\s+/g,"")),remember:p.attr("checked")?"on":"off",backUrl:u})})})},postJsonp:function(e,t){var o=$("#alertDiv");n.postJSONP(a.ajaxDomain+"/jsonp/accounts/login",t).then(function(e){if("success"==e.code)switch(a.group){case 0:a.ajax({url:"http://a.ruochu.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){a.ajax({url:"http://a.ruoxia.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){window.location.href=e.backUrl})});break;case 1:a.ajax({url:"http://a.heiyan.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){a.ajax({url:"http://a.ruoxia.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){window.location.href=e.backUrl})});break;case 2:a.ajax({url:"http://a.heiyan.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){a.ajax({url:"http://a.ruochu.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){window.location.href=e.backUrl})});break;case 3:a.ajax({url:"http://a.heiyan.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){a.ajax({url:"http://a.ruochu.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){a.ajax({url:"http://a.ruoxia.com/m/jsonp/accounts/tologin",dataType:"jsonp",data:{key:e.key}}).then(function(){window.location.href=e.backUrl})})})}else o.html('<div class="item"><div class="alert alert-error">'+(e.message||e.error)+"</div></div>")})}});return new c});